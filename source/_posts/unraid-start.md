---
title: Unraid初体验
date: 2022-11-21 03:55:47
tags:
  - Unraid
  - Nas
---

最近折腾 Truenas Scale 一直不是很满意，准备换个 Unraid 试一试。

<!--more-->

## 一、前期考虑

可能是我比较菜吧，折腾不来这个 Truenas。虽然搞了万兆交换机，接了万兆网卡，有 32GB 内存，raidz 的速度在硬盘少的情况下仍然不尽如人意。想要加几块硬盘，发现也不是很容易，没法提升原有 raid 的性能，只能横向扩展。而且 Truenas scale 的 docker 上了 k3s 还是稍微有些门槛，对我的应用场景来说也比较重了。以及众所周知的一些网络访问问题，大部分功能我其实也不大用到，使用起来实在比较僵硬。

于是考虑再三准备上手 Unraid。

我其实早就想试试 Unraid 了，之前看 LTT 视频，对 Unraid 的印象相当不错。突出一个特点，上手简单，灵活度又高。

从 Unraid 这个名字也能看出，这个系统的磁盘阵列不搞 raid，扩展起来非常容易。

而且只需要一块校验盘，只要损失不超过一块硬盘，都可以恢复。即使超过损失超过一块盘，也只会丢失那块盘的数据，不会影响整个阵列。这个数据安全性对于我来说是够了的。看网上的速度测试，在完成奇偶校验的情况下，有没有校验盘对整个阵列的读写速度没有什么影响。

既然不搞 raid，速度就受限于你的硬盘速度了，不过可以靠添加缓存盘来提升，只要读写不超过缓存盘的存储上限，都不会掉速。像万兆内网，加个 nvme 的硬盘，基本就可以跑满了。

为啥以前没有用呢，主要是 truenas 免费，而 Unraid 要钱嘛，而且组 nas 的时候偷懒让别人帮忙把系统装好了，懒得换了。Unraid 是按照硬盘数量收费的，不包括启动闪存盘，6 块硬盘需要 59 刀，12 块硬盘需要 89 刀，129 刀则不限硬盘数量。像我现在 7 块硬盘，加一块固态，后面还要加俩 nvme 做缓存，考虑到以后的扩展，应该得买 89 刀的就好。不过 Unraid 是一次性买断的，这样看似乎价格也还行，还有 30 天试用，让你充分考虑，许可也是可以后期升级的。

这次我先试用一波，没什么问题再上许可。

更新：

用着还不错，已经用上 Plus 许可了。

## 二、硬件配置

这边列下我的搭配，可能不是太常见。

- 主板: **Asus TUF GAMING B550M-PLUS WIFI II** （这 WIFI 说实话真浪费，可惜不带 WIFI 版本的都断货，没办法）
- CPU: **AMD Ryzen 5 3600**
- 内存: **16GB DDR4 纯 ecc 内存 _x2_**
- GPU: **Nvidia Quadra T600**（后面用来给 Plex 转码用）
- 电源: **海盗船 SFX 450W 电源**（刚开始装 itx 机子用的，闲置了好久）
- 硬盘:
  - **希捷酷狼 2TB _x7_** （其中一块做校验盘）
  - **致态 NVME TiPlus7100 1TB _x2_**（缓存盘）
  - **三星 870EVO**（闲置的盘，准备用来当 steam 库了）
- 扩展卡:
  - **SSU PCI-E x1 转 SATA3.0 x8 扩展卡**（主板上自带的 4 个 SATA 给 SATA 口的 SSD 用了）
  - **Mellanox 82599 双口万兆网卡**
  - **9PIN 转 USB2.0**（用来插在主板上，直接插系统 U 盘）
- 机箱: **银欣 CS381**（我用着还挺满意）
- 散热:（为了静音也算是下了血本了，事实证明效果拔群）
  - CPU 散热器: **猫头鹰 NH-L9a AM4 黑色版**
  - 机箱散热: **猫头鹰 NF-A12x25 PWM _x2_**

## 三、部署

[下载 Unraid OS](https://unraid.net/zh/%E4%B8%8B%E8%BD%BD)

首先你需要一个 U 盘。

- 最小 4GB，最大不超过 32GB，**一定要是 USB 2.0 的，不然系统可能读不到**。
- 格式化为 **FAT32 格式**，卷标必须为 **UNRAID** 这六个字母。
- 不用在意 U 盘速度，这个 U 盘只会用来装系统和一些配置，启动后整个系统都是直接放到内存里的，只会偶尔读下配置会用到 U 盘。Unraid 现在还不支持通过 sd 卡和硬盘进行启动，所以你的主板必须要支持通过 U 盘启动。

Unraid 现在提供了一个创建 U 盘启动器的工具，还是比较傻瓜式的。

![](https://img.iszy.xyz/1668965114372.png)

可以选择安装的分支和系统版本，设置一下访问地址、网络 ip 和启动方式。这个 server name 默认叫 Tower，后面启动好后，直接浏览器里输[http://tower.local](http://tower.local) 就行，这个后期也可以在设置改。

![](https://img.iszy.xyz/1668965501519.png)

这边是在线下载的系统包，实测下载速度有点慢。可以选择直接在刚刚的下载页面下载 zip 包。

![](https://img.iszy.xyz/1668965696359.png)

这个工具支持直接选择本地宝安装，就是不能设置了。

![](https://img.iszy.xyz/1668965764119.png)

本地包写完盘后是这样的。如果要 LAGENCY 模式启动，就这样就可以了。如果要 UEFI 模式启动，就把 `EFI-` 重命名为 `EFI` 就行。这个不是名字写错了嗷，是有用的。

![](https://img.iszy.xyz/1668966001368.png)

现在一块 Unraid 启动盘就做好了，接下来把这个 U 盘插到你的 Nas 主板上，在 Bios 里设置成启动盘启动就好啦。这块盘将会长期作为系统盘留在你的主板上了。需要注意的是，如果你的系统盘坏了，Unraid 是支持重写个系统盘更换的，但是**一年只提供一次迁移许可**，所以最好买一个质量有保证的 U 盘。

当系统启动好后，访问 [http://tower.local](http://tower.local) 即可进入 WebGUI 页面。第一次访问会让你设置 root 用户的密码。

![](https://img.iszy.xyz/1668966459094.png)

## 四、初始化配置

### 1. 时间设置

转到 `Settings` 选项卡，选择 `Date and Time`

将时区设置为北京时区，并设置时间同步 ntp 服务器。这里推荐下我用的。点击 Apply 应用。

- ntp.ntsc.ac.cn
- cn.ntp.org.cn
- time.pool.aliyun.com
- time1.cloud.tencent.com

![](https://img.iszy.xyz/1668966634982.png)

### 2. 网络设置

如果没有设置的话，默认会通过 dhcp 动态分配 ip，虽然我们大部分时候不需要直接使用 Unraid 的 ip，但是推荐设置为一个静态 ip，也可以设置下 dns。Unraid 可以配置端口聚合，我因为只接了一个万兆网口，所以就无所谓了，我也没改。

转到 `Settings` 选项卡，选择 `Networks`

我现在的配置如下。注意要在虚拟机和 docker 关闭的情况下修改。我这边万兆网卡是另外加的，默认网口没接，有个警告。

![](https://img.iszy.xyz/1668967055987.png)

使用万兆网卡，最好把 MTU 改为 9000，电脑的万兆网卡也改成 9000，以提升网络性能。

如何判断应用成功了呢。可以通过 ping 一个大包看看有没有返回，如果 MTU 为 1500，这个命令将无响应。

```shell
ping tower.lcoal -l 8962
```

![](https://img.iszy.xyz/1668967282997.png)

### 3. 安装中文插件

现在 Unraid 官方提供了中文插件包，可以对用户界面进行完整的汉化。

转到 `Apps` 选项卡，点击 install 即可自动安装 `Community Applications` 插件。在内容更新完成后，这边将展示各种社区应用，在左侧分类菜单里选择 Language，找到 简体中文语言包，点击 install 安装即可。

![](https://img.iszy.xyz/1668967574818.png)

接下来转到 `Settings` 选项卡，选择 `Display Settings`，此时已经可以选择中文语言了。

![](https://img.iszy.xyz/1668967669343.png)

### 4. 添加磁盘阵列

当然我们做 Nas，没有磁盘阵列可不行。

可以选择一到两块盘作为校验盘，一般一块就行了，安全要求不高可以不加，要求大于等于其他任意一块的容量，然后把其他盘添加到阵列里。

![](https://img.iszy.xyz/1668967785490.png)

有固态可以添加到缓存池里。

![](https://img.iszy.xyz/1668967990297.png)

完成后点击应用，点击启动阵列，此时校验盘会开始同步，容量越大，速度越慢。同步期间阵列访问速度也会很慢，推荐等到同步完成后再访问。点击格式化，完成阵列文件系统的格式化，阵列就可以使用了，不用等到同步完成。

![](https://img.iszy.xyz/1668968076515.png)

### 5. 添加共享

转到 `共享` 标签页，点击添加共享。

![](https://img.iszy.xyz/1668968286999.png)

按需要进行配置，我这边选择开启缓存。

![](https://img.iszy.xyz/1668968418876.png)

然后自动开启了 SMB 共享，可以进行设置。

![](https://img.iszy.xyz/1668968571494.png)

## 五、后记

今天先折腾到这里，Nas 的基础功能已经基本可用。后续等我加点缓存再测试测试。
